<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evan Downloader | Multi-Server</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- TEMA & DESIGN FIX --- */
        :root {
            --bg-color: #121212;
            --surface-color: #1E1E1E;
            --primary-color: #BB86FC;
            --text-main: #E0E0E0;
        }

        body, html {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            height: 100%;
        }

        .card-material {
            background-color: var(--surface-color);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            border: 1px solid #333;
            padding: 1.5rem;
        }

        .input.material-input {
            background-color: #2C2C2C;
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            height: 50px;
        }

        /* --- PERBAIKAN JUDUL BERTUMPUK (SCREENSHOT FIX) --- */
        .header-section {
            margin-bottom: 2rem;
            padding-top: 1rem;
        }
        .app-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            line-height: 1.2;
            margin-bottom: 0.5rem !important; /* Jarak aman ke bawah */
        }
        .app-subtitle {
            color: #A0A0A0;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .button.is-primary-mat {
            background-color: var(--primary-color);
            color: #000;
            border: none;
            font-weight: 700;
            height: 50px;
            transition: 0.3s;
        }
        .button.is-primary-mat:hover {
            background-color: #a370db;
            box-shadow: 0 0 15px rgba(187, 134, 252, 0.4);
        }

        .quality-btn {
            background-color: #333;
            color: white;
            margin-bottom: 10px;
            border-radius: 8px;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-decoration: none;
            transition: 0.2s;
        }
        .quality-btn:hover { background-color: #444; color: var(--primary-color); }

        #statusText { font-size: 0.8rem; margin-top: 10px; color: #888; }
    </style>
</head>
<body>

    <section class="section">
        <div class="container is-max-desktop">
            
            <div class="has-text-centered header-section">
                <h1 class="app-title">
                    <i class="fas fa-bolt" style="color:var(--primary-color)"></i> EvanDownloader
                </h1>
                <p class="app-subtitle">
                    YOUTUBE • TIKTOK • IG • FACEBOOK
                </p>
            </div>

            <div class="card-material">
                <div class="field has-addons">
                    <div class="control is-expanded">
                        <input class="input material-input" id="urlInput" type="text" placeholder="Tempel link video di sini...">
                    </div>
                    <div class="control">
                        <button class="button is-dark" style="height:50px;" onclick="pasteClip()">
                            <i class="fas fa-paste"></i>
                        </button>
                    </div>
                </div>

                <button class="button is-primary-mat is-fullwidth mt-4" onclick="processVideo()" id="btnProcess">
                    <span class="icon"><i class="fas fa-download"></i></span>
                    <span>PROSES VIDEO</span>
                </button>

                <p class="has-text-centered" id="statusText"></p>

                <div class="notification is-danger is-light mt-4 is-hidden" id="errorMsg">
                    <button class="delete" onclick="this.parentElement.classList.add('is-hidden')"></button>
                    <strong>Gagal!</strong> Semua server sibuk atau link tidak valid.
                </div>
            </div>

            <div class="card-material mt-5 is-hidden" id="resultArea">
                <div class="media">
                    <div class="media-left">
                        <figure class="image is-96x96">
                            <img id="thumbImg" src="" alt="Thumb" style="border-radius: 8px; object-fit: cover;">
                        </figure>
                    </div>
                    <div class="media-content">
                        <p class="title is-6 has-text-white" id="videoTitle">Video Title</p>
                        <p class="subtitle is-7 has-text-grey" id="platformTag">Platform</p>
                    </div>
                </div>
                <hr style="background-color: #333;">
                <div id="downloadList"></div>
            </div>

            <div class="has-text-centered mt-6 is-size-7 has-text-grey-dark">
                Powered by Cobalt API (Open Source)
            </div>
        </div>
    </section>

    <script>
        // DAFTAR SERVER CADANGAN (Jika satu mati, pindah ke bawahnya)
        const API_INSTANCES = [
            'https://cobalt.kwiatekmiki.pl/api/json',     // Server Cadangan 1
            'https://api.cobalt.tools/api/json',          // Server Utama (Sering strict)
            'https://cobalt.q1.si/api/json',              // Server Cadangan 2
            'https://co.wuk.sh/api/json'                  // Server Lama (Sering Down)
        ];

        async function pasteClip() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('urlInput').value = text;
            } catch (e) { alert('Izin paste ditolak browser'); }
        }

        async function processVideo() {
            const url = document.getElementById('urlInput').value.trim();
            const btn = document.getElementById('btnProcess');
            const statusText = document.getElementById('statusText');
            const resultArea = document.getElementById('resultArea');
            const errorMsg = document.getElementById('errorMsg');
            const downloadList = document.getElementById('downloadList');

            if (!url) { alert("Masukkan link dulu bro!"); return; }

            // Reset UI
            btn.classList.add('is-loading');
            resultArea.classList.add('is-hidden');
            errorMsg.classList.add('is-hidden');
            downloadList.innerHTML = '';
            
            let success = false;

            // --- LOOPING SERVER (Logika Anti-Macet) ---
            for (const apiBase of API_INSTANCES) {
                if(success) break; // Jika sudah berhasil, stop looping
                
                try {
                    statusText.innerText = `Mencoba server: ${new URL(apiBase).hostname}...`;
                    
                    const response = await fetch(apiBase, {
                        method: 'POST',
                        headers: { 
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' 
                        },
                        body: JSON.stringify({
                            url: url,
                            vQuality: "max",
                            isAudioOnly: false
                        })
                    });

                    const data = await response.json();
                    
                    if (['error', 'rate-limit'].includes(data.status)) throw new Error("Server error");
                    
                    // JIKA SUKSES SAMPAI SINI:
                    success = true;
                    statusText.innerText = "Berhasil!";
                    renderResult(data, url);

                } catch (err) {
                    console.log(`Gagal di ${apiBase}, lanjut server berikutnya...`);
                }
            }

            // Jika semua server gagal
            if (!success) {
                statusText.innerText = "";
                errorMsg.classList.remove('is-hidden');
            }
            
            btn.classList.remove('is-loading');
        }

        function renderResult(data, originalUrl) {
            document.getElementById('resultArea').classList.remove('is-hidden');
            
            // Set Judul & Thumb (Default jika kosong)
            document.getElementById('videoTitle').innerText = data.filename || "Video Siap Download";
            document.getElementById('thumbImg').src = "https://img.icons8.com/fluency/96/video.png"; // Icon default
            
            // Deteksi Platform
            let platform = "Web";
            if(originalUrl.includes('youtu')) platform = "YouTube";
            if(originalUrl.includes('tiktok')) platform = "TikTok";
            if(originalUrl.includes('instagram')) platform = "Instagram";
            document.getElementById('platformTag').innerText = platform;

            const container = document.getElementById('downloadList');

            // Render Tombol
            if (data.url) createBtn(data.url, "Download Video (HD)", "fas fa-video");
            if (data.picker) {
                data.picker.forEach(p => {
                    createBtn(p.url, `Download ${p.type.toUpperCase()}`, p.type === 'audio' ? "fas fa-music" : "fas fa-video");
                });
            }
            if (data.audio) createBtn(data.audio, "Download Audio Only", "fas fa-music");
        }

        function createBtn(link, text, icon) {
            const a = document.createElement('a');
            a.className = 'quality-btn';
            a.href = link;
            a.target = '_blank';
            a.innerHTML = `<span><i class="${icon} mr-2"></i> ${text}</span> <i class="fas fa-chevron-right"></i>`;
            document.getElementById('downloadList').appendChild(a);
        }
    </script>
</body>
</html>
